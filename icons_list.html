<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Web Atlas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="dist/css/webAtlas-icons.css" />
    <link rel="stylesheet" type="text/css" href="dist/css/font-face/webAtlas-icons.css" />
    <link rel="stylesheet" type="text/css" href="dist/css/font-face/webAtlas-alphanumeric.css" />
    <link rel="stylesheet" type="text/css" href="node_modules/font_logos/logos.css" />

    <style>
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            color:rgb(80, 80, 80);
            background: rgba(222, 222, 222);
            font-family: "WebAtlas";
        }

        h2 {
            text-align: left;
            font-family: 'WebAtlas-Light';
            font-size: 25px;
            margin: 8px;
            margin-top: 30px;
        }

        #sidebar h2 {
            text-align: center;
            color:rgb(111, 186, 255);
        }

        #content hr {
            width: 300px;
            max-width: 100%;
            margin-left: 0;
        }

        select {
            width: 180px;
            padding: 3px 10px;
            border-radius: 10px;
            color: rgb(60, 60, 60);
            font-family: webAtlas;
            font-size: 1.2em;
            background: none;
            border: 2px solid rgb(60, 60, 60);
            margin: 20px auto;
            display: block;
            outline: none;
        }
        select:disabled {
            opacity: .5;
        }

        select option {
            color: white;
            background-color: rgb(60, 60, 60);
        }

        #header, #sidebar {
            box-sizing: border-box;
            position: fixed;
        }

        #header {
            width: 100%;
            height: 80px;
            padding: .5em;
            font-size: 40px;
            line-height: 40px;
            background-color: white;
            box-shadow: 0 0 6px 6px rgba(0, 0, 0, .2);
        }
        #header h1 {
            line-height: 40px;
            vertical-align: top;
            font-weight: normal;
            margin: 0;
            font-size: 40px;
            display: inline-block;
        }
        #search {
            width: 200px;
            height: 40px;
            line-height: 40px;
            margin: 0 1.5em;
            padding-left: .5em;
            color:rgb(140, 140, 140);
            font-size: 26px;
            background-color: rgb(240, 240, 240);
            box-shadow: 0 0 12px inset rgba(150, 150, 150, 0.45);
            border-radius: 20px;
            display: inline-block;
            vertical-align: top;
        }
        #search input[type=text] {
            width: 154px;
            color:rgb(140, 140, 140);
            line-height: 40px;
            font-size: 25px;
            font-family: WebAtlas;
            border: none;
            background: none;
            outline: none;
        }

        #sidebar {
            width: 250px;
            padding: 1em;
            background: white;
            box-shadow: 0 0 3em inset rgba(0, 0, 0, .3);
            top: 80px;
            left: 0;
            bottom: 0;
            position: fixed;
        }
        #sidebar .btn {
            background-color: white;
            line-height: 1.7em;
            font-size: 1.2em;
            text-align: center;
        }

        #content {
            overflow: auto;
            top: 80px;
            left: 250px;
            right: 0;
            bottom: 0;
            position: fixed;
        }
        #content.gridMode .item  {
            width: 60px;
            height: 60px;
            line-height: 50px;
            margin: 0;
        }
        #content.gridMode .item .title, #content.gridMode .item .wrapper {
            display: none;
        }

        #divIcons {
            padding: 1em;
        }

        #topRightCorner {
            width: 230px;
            height: 60px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom-left-radius: 6px;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
            position: fixed;
            top: 0;
            right: 0;
        }

        #arrowUp {
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            font-size: 22px;
            border-radius: 100%;
            opacity: .0;
            cursor: default;
            transition: opacity .5s;
            background-color: white;
            position: fixed;
            right: 30px;
            bottom: 30px;
        }
        #arrowUp:active {
            box-shadow: inset 0 -1px 18px rgba(78, 82, 87, 0.6), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.1), transparent 50%, rgba(255, 255, 255, 0.07));
        }

        #switchDisplayMode {
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            font-size: 26px;
            cursor: pointer;
            position: fixed;
            top: 20px;
            right: 20px;
        }

        #messageLine {
            font-family: 'WebAtlas';
            line-height: 28px;
            font-size: 20px;
            padding: .3em .5em;
            box-sizing: border-box;
            overflow: hidden;
            opacity: 0;
            transition: opacity .2s;
            background: rgb(111, 186, 255);
            cursor: pointer;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            z-index: 1;
        }

        .btn {
            background: rgb(240, 240, 240);
            border-radius: 3px;
            box-shadow:
                inset 0 1px rgba(255, 255, 255, 0.1),
                inset 0 -1px 3px rgba(0, 0, 0, 0.3),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1),
                0 1px 2px rgba(0, 0, 0, 0.15);
            cursor: pointer;
        }
        .btn:active {
            box-shadow: inset 0 -1px 18px rgba(78, 82, 87, 0.6), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.1), transparent 50%, rgba(255, 255, 255, 0.07));
        }

        .item {
            width: 100px;
            box-sizing: border-box;
            padding: 5px;
            margin: 4px;
            font-size: 30px;
            text-align: center;
            background-clip: border-box;
            vertical-align: top;
            animation: flipInX .5s;
            display: inline-block;
            position: relative;
        }
        .item .wrapper {
            position: absolute;
            height: 22px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            background: linear-gradient(to right,
                rgba(240,240,240,1) 0%,
                rgba(240,240,240,0) 5%,
                rgba(240,240,240,0) 95%,
                rgba(240,240,240,1) 100%
            );
        }
        .item .title {
            overflow: hidden;
            padding: 0 10px;
            font-size: 18px;
            white-space: nowrap;
        }

        .item:active .wrapper {
            display: none;
        }

        @keyframes flipInX {
            0% {
                transform: rotateX(90deg);
            }

            100% {
                transform: rotateX(0deg);
            }
        }
    </style>
</head>

<body>
    <input type="text" id="inputClipboard" style="display:none" />

    <div id="header">
        <h1>Font WebAtlas</h1>
        <label id="search" class="icon-first magnify">
            <input id="search_input" type="text">
        </label>
    </div>

    <div id="sidebar">
        <h2>Style:</h2>
        <select id="select_style" autocomplete="off"></select>

        <h2>Packs:</h2>
        <div id="btn_base" class="btn">Base</div>

        <h2>Add on:</h2>
        <div id="btn_logos" class="btn">Logos & Social Medias</div>

    </div>

    <div id="content">
        <div id="messageLine">
            <span id="messageLine_icon" class="icon"></span>
            <span id="messageLine_message" class="message"></span>
        </div>

        <div id="divIcons"></div>
    </div>
    
    <div id="switchDisplayMode" class="icon menu"></div>
    <div id="arrowUp" class="btn icon arrow-up"></div>

    <script>
        var content = document.getElementById('content');
        var divIcons = document.getElementById('divIcons');
        var gianteIcon = document.getElementById('gianteIcon');
        var arrowUp = document.getElementById('arrowUp');
        var switchDisplayMode = document.getElementById('switchDisplayMode');
        var inputClipboard = document.getElementById('inputClipboard');
        var select_style = document.getElementById('select_style');
        var search_input = document.getElementById('search_input');
        var messageLine = document.getElementById('messageLine');
        var messageLine_icon = document.getElementById('messageLine_icon');
        var messageLine_message = document.getElementById('messageLine_message');
        var btn_base = document.getElementById('btn_base');
        var btn_logos = document.getElementById('btn_logos');

        var TIME_INTERVAL = 10;
        var TEXTS = {
            intro: "Clic on an item to copy the className on clipboard.",
            trademark: "This work includes material that may be protected as a trademark in some jurisdictions. If you want to use it, you have to ensure that you have the legal right to do so and that you do not infringe any trademark rights. See the trademark owner for rules about appropriate use of their trademarks."
        };

        var iconsElements = [];

        var data = null;


        /* INIT */

        data = loadJSON("icons.json", null, init);
        data_logos = loadJSON("node_modules/font_logos/logos.json");

        function loadJSON(url, args, func, func_error) {
            var obj = {};
            var xhr = new XMLHttpRequest();

            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            
            if (typeof args === "object") {
                var str = "";

                for (const arg in args) {
                    str += arg + "=" + args[arg] + "&";
                }
                str = str.substring(0, str.length-1);
                
                xhr.send(str);
            }
            else
                xhr.send();

            xhr.onreadystatechange = function () {
                var xhr = this;

                if (xhr.readyState != xhr.DONE)
                    return false;

                if (xhr.status == 200) {
                    try {
                        newObj = JSON.parse(xhr.response);
                        Object.assign(obj, newObj);
                    }
                    catch (error) {
                        func_error ? func_error(error) : console.warn(error);
                        return false;
                    }

                    if (func)
                        func();
                }
                else {
                    var error = "loadJSON Error " + xhr.status;
                    func_error ? func_error(error) : console.warn(error);
                }
            }

            return obj;
        }

        function init() {
            loadList(data.icons);

            for (let i = 0; i < data.styles.length; i++) {
                const style = data.styles[i];
                let e = document.createElement('option');
                e.value = style;
                e.innerHTML = ucfirst(style);
                select_style.appendChild(e);
            }

            showMessage("circle-info outline", TEXTS.intro);
        }

        content.onscroll = function () {
            messageLine.style.top = this.scrollTop + "px";

            if (this.scrollTop === 0) {
                arrowUp.style.opacity = "0";
                arrowUp.style.cursor = "default";
            }
            else {
                arrowUp.style.opacity = "1";
                arrowUp.style.cursor = "pointer";
            }
        }

        content.onclick = function (e) {
            var ele = e.target;

            if (hasClass("icon", ele)) {
                ele = ele.parentElement;
            }

            if (ele.className === "btn item") {
                inputClipboard.style.display = 'block';
                inputClipboard.value = ele.codeIcon;
                inputClipboard.select();
                document.execCommand('copy');
                inputClipboard.blur();
                inputClipboard.style.display = 'none';

                showMessage(ele.codeIcon, "has been copied to the clipboard!");
            }
        };

        select_style.onchange = function () {
            loadList(data["icons"], this.value);
        };

        messageLine.onclick = function () {
            this.style.opacity = 0;
        };

        btn_base.onclick = function () {
            loadList(data.icons);

            select_style.disabled = false;
        };

        btn_logos.onclick = function () {
            loadList(data_logos.icons);

            showMessage("circle-info outline", TEXTS.trademark);

            select_style.disabled = true;
        };

        arrowUp.onclick = function () {
            if (content.scrollTop !== 0) {
                content.scrollTop = 0;
            }
        }

        search_input.onkeydown = function () {
            setTimeout(function () {
                search();
            }, 1);
        }

        function showMessage(icon, message) {
            messageLine.style.opacity = 1;
            messageLine_icon.className = "icon " + select_style.value + " " + icon;
            messageLine_message.innerHTML = message;
        }

        function search() {
            const s = search_input.value;

            if (s === "") {
                showAllIcones();
                return false;
            }

            for (let i = 0; i < iconsElements.length; i++) {
                const e = iconsElements[i];
                const iconName = e.childNodes[1].firstChild.nodeValue;

                if (iconName.indexOf(s) !== -1)
                    e.style.display = "";
                else
                    e.style.display = "none";
            }
        }

        function showAllIcones() {
            for (let i = 0; i < iconsElements.length; i++) {
                iconsElements[i].style.display = "";
            }
        }

        function loadList(icons, style) {
            divIcons.innerHTML = "";

            for (category in icons) {
                var list = icons[category];

                var newH2 = document.createElement('h2');
                newH2.innerHTML = category;
                divIcons.appendChild(newH2);
                divIcons.appendChild(document.createElement('hr'));

                for (var i = 0; i < list.length; i++) {
                    var icon = list[i];
                    var newDiv = document.createElement('div');
                    var newDivIcon = document.createElement('div');
                    var newDivWrapper = document.createElement('div');
                    var newDivTitle = document.createElement('div');

                    newDivIcon.className = "icon " + icon;
                    if (style) addClass(style, newDivIcon);
                    newDiv.appendChild(newDivIcon);
                    newDiv.className = "btn item";
                    newDiv.codeIcon = icon;

                    newDivWrapper.className = "wrapper";

                    newDivTitle.className = "title";
                    newDivTitle.appendChild(document.createTextNode(icon));
                    newDiv.appendChild(newDivTitle);
                    newDiv.appendChild(newDivWrapper);

                    iconsElements.push(newDiv);
                    divIcons.appendChild(newDiv);

                    if (newDivTitle.scrollWidth > newDivTitle.offsetWidth) {
                        var empty = document.createElement("span");

                        empty.style.width = "5px";
                        empty.style.display = "inline-block";
                        newDivTitle.appendChild(empty);   // Permet un scrolling total
                    }
                }
            }
        }

        switchDisplayMode.onclick = function () {
            if (hasClass("menu", this)) {
                removeClass("menu", this);
                addClass("apps", this);
            }
            else {
                removeClass("apps", this);
                addClass("menu", this);
            }

            toggleClass("gridMode", content);
        }

        function ucfirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }


        // MANIPULATION DE CLASS
        // Utile pour IE < 10 (classList n'étant pas compatible avant Internet Explorer 10)

        function hasClass(c, element) {
            if (element.className == '')
                return false;

            var classes = element.className.split(' ');
            return classes.indexOf(c) !== -1;
        }

        function addClass(c, element) {
            if (hasClass(c, element))
                return false;

            element.className += " " + c;
            return true;
        }

        function removeClass(c, element) {
            if (!hasClass(c, element))
                return false;

            var classes = element.className.split(' ');
            var newClass = "";
            var indexToRemove = classes.indexOf(c);

            classes.splice(indexToRemove, 1);

            if (classes.length > 0)
                newClass = classes[0];

            for (var i = 1; i < classes.length; i++) {
                newClass += " " + classes[i];
            }

            element.className = newClass;

            return true;
        }

        function toggleClass(c, element) {	/* Ajoute la class si elle n'existe pas ou Supprime la class si elle existe */
            if (!removeClass(c, element)) {
                addClass(c, element);
                return true;
            }

            return false;
        }
    </script>
</body>

</html>